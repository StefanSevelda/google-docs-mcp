<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastMCP Google Docs Server Docs</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { font-family: sans-serif; line-height: 1.6; padding: 20px; }
        pre { background-color: #f4f4f4; padding: 10px; border-radius: 5px; overflow-x: auto; }
        code { font-family: monospace; }
        h1, h2, h3 { border-bottom: 1px solid #eee; padding-bottom: 5px; margin-top: 20px; }
    </style>
</head>
<body>
    <div id="content"></div>

    <script type="text/markdown" id="markdown-content">
# FastMCP Google Docs Server

Connect Claude Desktop (or other MCP clients) to your Google Docs!

This comprehensive MCP server provides **30+ tools** for reading, editing, formatting, and managing Google Documents and Drive files. It acts as a powerful bridge, allowing AI assistants like Claude to interact with your documents programmatically.

**Features:**

- **üìñ Document Access:** Read documents in text, JSON, or Markdown format
- **‚úèÔ∏è Content Editing:** Insert, append, delete, and replace text with precision
- **üé® Rich Formatting:** Apply text styles (bold, italic, colors, fonts) and paragraph styles (headings, alignment, spacing)
- **üìä Document Structure:** Create and edit tables, insert images, add page breaks
- **üí¨ Comment Management:** List, read, add, reply to, and resolve comments
- **üìÅ Drive Integration:** Search, list, create, move, copy, rename, and delete files and folders
- **üîí Security Hardened:** Query injection prevention, SSRF protection, path traversal safeguards
- **ü§ñ Claude Code Agents:** Includes 6 specialized agents for development assistance
- **üîß Template Support:** Create documents from templates with variable replacement
- **üîç Smart Search:** Find text with instance matching, search across Drive
- **üóÇÔ∏è Folder Management:** Complete folder hierarchy navigation and organization

---

## Prerequisites

Before you start, make sure you have:

1.  **Node.js and npm:** A recent version of Node.js (which includes npm) installed on your computer. You can download it from [nodejs.org](https://nodejs.org/). (Version 18 or higher recommended).
2.  **Git:** Required for cloning this repository. ([Download Git](https://git-scm.com/downloads)).
3.  **A Google Account:** The account that owns or has access to the Google Docs you want to interact with.
4.  **Command Line Familiarity:** Basic comfort using a terminal or command prompt (like Terminal on macOS/Linux, or Command Prompt/PowerShell on Windows).
5.  **Claude Desktop (Optional):** If your goal is to connect this server to Claude, you'll need the Claude Desktop application installed.

---

## Setup Instructions

Follow these steps carefully to get your own instance of the server running.

### Step 1: Google Cloud Project & Credentials (The Important Bit!)

This server needs permission to talk to Google APIs on your behalf. You'll create special "keys" (credentials) that only your server will use.

1.  **Go to Google Cloud Console:** Open your web browser and go to the [Google Cloud Console](https://console.cloud.google.com/). You might need to log in with your Google Account.
2.  **Create or Select a Project:**
    - If you don't have a project, click the project dropdown near the top and select "NEW PROJECT". Give it a name (e.g., "My MCP Docs Server") and click "CREATE".
    - If you have existing projects, you can select one or create a new one.
3.  **Enable APIs:** You need to turn on the specific Google services this server uses.
    - In the search bar at the top, type "APIs & Services" and select "Library".
    - Search for "**Google Docs API**" and click on it. Then click the "**ENABLE**" button.
    - Search for "**Google Drive API**" and click on it. Then click the "**ENABLE**" button (this is often needed for finding files or permissions).
4.  **Configure OAuth Consent Screen:** This screen tells users (usually just you) what your app wants permission for.
    - On the left menu, click "APIs & Services" -> "**OAuth consent screen**".
    - Choose User Type: Select "**External**" and click "CREATE".
    - Fill in App Information:
      - **App name:** Give it a name users will see (e.g., "Claude Docs MCP Access").
      - **User support email:** Select your email address.
      - **Developer contact information:** Enter your email address.
    - Click "**SAVE AND CONTINUE**".
    - **Scopes:** Click "**ADD OR REMOVE SCOPES**". Search for and add the following scopes:
      - `https://www.googleapis.com/auth/documents` (Allows reading/writing docs)
      - `https://www.googleapis.com/auth/drive.file` (Allows access to specific files opened/created by the app)
      - Click "**UPDATE**".
    - Click "**SAVE AND CONTINUE**".
    - **Test Users:** Click "**ADD USERS**". Enter the same Google email address you are logged in with. Click "**ADD**". This allows _you_ to use the app while it's in "testing" mode.
    - Click "**SAVE AND CONTINUE**". Review the summary and click "**BACK TO DASHBOARD**".
5.  **Create Credentials (The Keys!):**
    - On the left menu, click "APIs & Services" -> "**Credentials**".
    - Click "**+ CREATE CREDENTIALS**" at the top and choose "**OAuth client ID**".
    - **Application type:** Select "**Desktop app**" from the dropdown.
    - **Name:** Give it a name (e.g., "MCP Docs Desktop Client").
    - Click "**CREATE**".
6.  **‚¨áÔ∏è DOWNLOAD THE CREDENTIALS FILE:** A box will pop up showing your Client ID. Click the "**DOWNLOAD JSON**" button.
    - Save this file. It will likely be named something like `client_secret_....json`.
    - **IMPORTANT:** Rename the downloaded file to exactly `credentials.json`.
7.  ‚ö†Ô∏è **SECURITY WARNING:** Treat this `credentials.json` file like a password! Do not share it publicly, and **never commit it to GitHub.** Anyone with this file could potentially pretend to be _your application_ (though they'd still need user consent to access data).

### Step 2: Get the Server Code

1.  **Clone the Repository:** Open your terminal/command prompt and run:
    ```bash
    git clone https://github.com/StefanSevelda/google-docs-mcp.git mcp-googledocs-server
    ```
2.  **Navigate into Directory:**
    ```bash
    cd mcp-googledocs-server
    ```
3.  **Place Credentials:** Move or copy the `credentials.json` file you downloaded and renamed (from Step 1.6) directly into this `mcp-googledocs-server` folder.

### Step 3: Install Dependencies

Your server needs some helper libraries specified in the `package.json` file.

1.  In your terminal (make sure you are inside the `mcp-googledocs-server` directory), run:
    ```bash
    npm install
    ```
    This will download and install all the necessary packages into a `node_modules` folder.

### Step 4: Build the Server Code

The server is written in TypeScript (`.ts`), but we need to compile it into JavaScript (`.js`) that Node.js can run directly.

1.  In your terminal, run:
    ```bash
    npm run build
    ```
    This uses the TypeScript compiler (`tsc`) to create a `dist` folder containing the compiled JavaScript files.

### Step 5: First Run & Google Authorization (One Time Only)

Now you need to run the server once manually to grant it permission to access your Google account data. This will create a `token.json` file that saves your permission grant.

1.  In your terminal, run the _compiled_ server using `node`:
    ```bash
    node ./dist/server.js
    ```
2.  **Watch the Terminal:** The script will print:
    - Status messages (like "Attempting to authorize...").
    - An "Authorize this app by visiting this url:" message followed by a long `https://accounts.google.com/...` URL.
3.  **Authorize in Browser:**
    - Copy the entire long URL from the terminal.
    - Paste the URL into your web browser and press Enter.
    - Log in with the **same Google account** you added as a Test User in Step 1.4.
    - Google will show a screen asking for permission for your app ("Claude Docs MCP Access" or similar) to access Google Docs/Drive. Review and click "**Allow**" or "**Grant**".
4.  **Get the Authorization Code:**
    - After clicking Allow, your browser will likely try to redirect to `http://localhost` and show a **"This site can't be reached" error**. **THIS IS NORMAL!**
    - Look **carefully** at the URL in your browser's address bar. It will look like `http://localhost/?code=4/0Axxxxxxxxxxxxxx&scope=...`
    - Copy the long string of characters **between `code=` and the `&scope` part**. This is your single-use authorization code.
5.  **Paste Code into Terminal:** Go back to your terminal where the script is waiting ("Enter the code from that page here:"). Paste the code you just copied.
6.  **Press Enter.**
7.  **Success!** The script should print:
    - "Authentication successful!"
    - "Token stored to .../token.json"
    - It will then finish starting and likely print "Awaiting MCP client connection via stdio..." or similar, and then exit (or you can press `Ctrl+C` to stop it).
8.  ‚úÖ **Check:** You should now see a new file named `token.json` in your `mcp-googledocs-server` folder.
9.  ‚ö†Ô∏è **SECURITY WARNING:** This `token.json` file contains the key that allows the server to access your Google account _without_ asking again. Protect it like a password. **Do not commit it to GitHub.** The included `.gitignore` file should prevent this automatically.

### Step 6: Configure Claude Desktop (Optional)

If you want to use this server with Claude Desktop, you need to tell Claude how to run it.

1.  **Find Your Absolute Path:** You need the full path to the server code.
    - In your terminal, make sure you are still inside the `mcp-googledocs-server` directory.
    - Run the `pwd` command (on macOS/Linux) or `cd` (on Windows, just displays the path).
    - Copy the full path (e.g., `/Users/yourname/projects/mcp-googledocs-server` or `C:\Users\yourname\projects\mcp-googledocs-server`).
2.  **Locate `mcp_config.json`:** Find Claude's configuration file:
    - **macOS:** `~/Library/Application Support/Claude/mcp_config.json` (You might need to use Finder's "Go" -> "Go to Folder..." menu and paste `~/Library/Application Support/Claude/`)
    - **Windows:** `%APPDATA%\Claude\mcp_config.json` (Paste `%APPDATA%\Claude` into File Explorer's address bar)
    - **Linux:** `~/.config/Claude/mcp_config.json`
    - _If the `Claude` folder or `mcp_config.json` file doesn't exist, create them._
3.  **Edit `mcp_config.json`:** Open the file in a text editor. Add or modify the `mcpServers` section like this, **replacing `/PATH/TO/YOUR/CLONED/REPO` with the actual absolute path you copied in Step 6.1**:

    ```json
    {
      "mcpServers": {
        "google-docs-mcp": {
          "command": "node",
          "args": [
            "/PATH/TO/YOUR/CLONED/REPO/mcp-googledocs-server/dist/server.js"
          ],
          "env": {}
        }
        // Add commas here if you have other servers defined
      }
      // Other Claude settings might be here
    }
    ```

    - **Make sure the path in `"args"` is correct and absolute!**
    - If the file already existed, carefully merge this entry into the existing `mcpServers` object. Ensure the JSON is valid (check commas!).

4.  **Save `mcp_config.json`.**
5.  **Restart Claude Desktop:** Close Claude completely and reopen it.

---

## Usage with Claude Desktop

Once configured, you should be able to use the tools in your chats with Claude:

- "Use the `google-docs-mcp` server to read the document with ID `YOUR_GOOGLE_DOC_ID`."
- "Can you get the content of Google Doc `YOUR_GOOGLE_DOC_ID`?"
- "Append 'This was added by Claude!' to document `YOUR_GOOGLE_DOC_ID` using the `google-docs-mcp` tool."

Remember to replace `YOUR_GOOGLE_DOC_ID` with the actual ID from a Google Doc's URL (the long string between `/d/` and `/edit`).

Claude will automatically launch your server in the background when needed using the command you provided. You do **not** need to run `node ./dist/server.js` manually anymore.

---

## Security & Token Storage

- **`.gitignore`:** This repository includes a `.gitignore` file which should prevent you from accidentally committing your sensitive `credentials.json` and `token.json` files. **Do not remove these lines from `.gitignore`**.
- **Token Storage:** This server stores the Google authorization token (`token.json`) directly in the project folder for simplicity during setup. In production or more security-sensitive environments, consider storing this token more securely, such as using system keychains, encrypted files, or dedicated secret management services.

---

## Troubleshooting

- **Claude shows "Failed" or "Could not attach":**
  - Double-check the absolute path in `mcp_config.json`.
  - Ensure you ran `npm run build` successfully and the `dist` folder exists.
  - Try running the command from `mcp_config.json` manually in your terminal: `node /PATH/TO/YOUR/CLONED/REPO/mcp-googledocs-server/dist/server.js`. Look for any errors printed.
  - Check the Claude Desktop logs (see the official MCP debugging guide).
  - Make sure all `console.log` status messages in the server code were changed to `console.error`.
- **Google Authorization Errors:**
  - Ensure you enabled the correct APIs (Docs, Drive).
  - Make sure you added your email as a Test User on the OAuth Consent Screen.
  - Verify the `credentials.json` file is correctly placed in the project root.

---

## Available Tools

This server provides **30+ MCP tools** organized into the following categories:

### üìñ Document Access & Reading (4 tools)

**`readGoogleDoc`** - Read document content in multiple formats
- `format`: Choose 'text', 'json', or 'markdown' output
- `maxLength`: Optional character limit for text output
- Supports full document structure analysis in JSON format
- Experimental markdown conversion with formatting preservation

**`appendToGoogleDoc`** - Append text to the end of a document
- `addNewlineIfNeeded`: Automatically adds newline before content
- Smart positioning at document end

**`insertText`** - Insert text at a specific index
- Precise 1-based index positioning
- Use for targeted content insertion

**`deleteRange`** - Delete content within a specified range
- Start index (inclusive) and end index (exclusive)
- Validates range boundaries

### üé® Formatting & Styling (3 tools)

**`applyTextStyle`** - Apply character-level formatting
- Target by exact range OR by finding specific text
- `matchInstance`: Find 1st, 2nd, 3rd, etc. occurrence
- Styles: bold, italic, underline, strikethrough
- Colors: foregroundColor, backgroundColor (hex format)
- Font: fontSize (points), fontFamily
- Links: linkUrl (convert text to hyperlink)

**`applyParagraphStyle`** - Apply paragraph-level formatting
- Target by range, by finding text, or by index within paragraph
- Alignment: LEFT, CENTER, RIGHT, JUSTIFIED
- Spacing: spaceAbove, spaceBelow, indentStart, indentEnd
- Named styles: HEADING_1 through HEADING_6, TITLE, SUBTITLE, NORMAL_TEXT
- `keepWithNext`: Prevent page breaks between paragraphs

**`formatMatchingText`** - Legacy tool for text formatting
- Simplified interface for common formatting tasks
- Finds and formats text in one operation

### üìä Document Structure (5 tools)

**`insertTable`** - Create tables with specified dimensions
- `rows`: Number of table rows
- `columns`: Number of table columns
- `index`: Insertion point in document

**`editTableCell`** - Modify table cell content and styling
- `tableStartIndex`: Table element start position
- `rowIndex`, `columnIndex`: Cell coordinates (0-based)
- `textContent`: Replace cell text
- Apply text and paragraph styles to cells

**`insertPageBreak`** - Insert page breaks
- `index`: Position for page break

**`insertImageFromUrl`** - Insert images from public URLs
- `imageUrl`: Must be publicly accessible HTTP/HTTPS URL
- `width`, `height`: Optional dimensions in points
- SSRF protection: Blocks private IP addresses

**`insertLocalImage`** - Upload and insert local images
- `localImagePath`: Absolute path to image file
- Supports: .jpg, .jpeg, .png, .gif, .bmp, .webp, .svg
- `uploadToSameFolder`: Place in same folder as document (default: true)
- Path traversal protection
- File validation for security

### üí¨ Comment Management (6 tools)

**`listComments`** - List all comments in a document
- Returns comment IDs, authors, content, and status
- Includes quoted text context

**`getComment`** - Get specific comment with full thread
- `commentId`: Comment identifier
- Returns all replies in thread

**`addComment`** - Add comment anchored to text range
- `startIndex`, `endIndex`: Text range for comment
- `commentText`: Comment content

**`replyToComment`** - Reply to existing comment
- `commentId`: Parent comment
- `replyText`: Reply content

**`resolveComment`** - Mark comment as resolved
- `commentId`: Comment to resolve

**`deleteComment`** - Delete comment from document
- `commentId`: Comment to remove
- Requires appropriate permissions

### üìÅ Drive Integration - Discovery (4 tools)

**`listGoogleDocs`** - List documents with filtering
- `query`: Search query string (Drive API syntax)
- `orderBy`: Sort by name, modifiedTime, or createdTime
- `maxResults`: Limit results (1-100)
- Query injection prevention

**`searchGoogleDocs`** - Search documents by name or content
- `searchQuery`: Search term
- `searchIn`: Search in 'name', 'content', or 'both'
- `modifiedAfter`: Filter by modification date (ISO 8601)
- `maxResults`: Limit results

**`getRecentGoogleDocs`** - Get recently modified documents
- `daysBack`: How many days to look back (1-365)
- `maxResults`: Limit results

**`getDocumentInfo`** - Get detailed document metadata
- Returns title, created/modified times, permissions, size

### üìÅ Drive Integration - Folders (3 tools)

**`createFolder`** - Create new folder
- `name`: Folder name
- `parentFolderId`: Optional parent folder (default: Drive root)

**`listFolderContents`** - List folder contents
- `folderId`: Folder to list (use "root" for Drive root)
- `includeFiles`, `includeSubfolders`: Filter content types
- `maxResults`: Limit results

**`getFolderInfo`** - Get folder metadata
- Returns name, path, created/modified times, permissions

### üìÅ Drive Integration - File Operations (5 tools)

**`moveFile`** - Move file or folder to different location
- `fileId`: File/folder to move
- `newParentId`: Destination folder (use "root" for Drive root)
- `removeFromAllParents`: Remove from all current parents

**`copyFile`** - Create copy of file
- `fileId`: File to copy
- `newName`: Optional name for copy
- `parentFolderId`: Optional destination

**`renameFile`** - Rename file or folder
- `fileId`: File/folder to rename
- `newName`: New name

**`deleteFile`** - Delete file or folder
- `fileId`: File/folder to delete
- `skipTrash`: true for permanent deletion, false to move to trash

**`createDocument`** - Create new Google Document
- `title`: Document title
- `initialContent`: Optional starting text
- `parentFolderId`: Optional folder location

**`createFromTemplate`** - Create document from template
- `templateId`: Template document ID
- `newTitle`: New document title
- `replacements`: Object with {{variable}} replacements
- `parentFolderId`: Optional folder location

### üîß Experimental Tools (2 tools)

**`fixListFormatting`** - Detect and convert text lists to proper formatting
- Finds lines starting with -, *, 1., etc.
- Converts to proper Google Docs lists
- Experimental: May require manual review
- `range`: Optional range to limit scope

**`findElement`** - Find document elements by criteria
- Not fully implemented
- Placeholder for future element searching

---

## Tool Usage Examples

### Reading a Document

```javascript
// Get document as plain text
await readGoogleDoc({
  documentId: "YOUR_DOC_ID",
  format: "text"
});

// Get document as Markdown
await readGoogleDoc({
  documentId: "YOUR_DOC_ID",
  format: "markdown"
});
```

### Formatting Text

```javascript
// Make all instances of "Important" bold and red
await applyTextStyle({
  documentId: "YOUR_DOC_ID",
  target: {
    textToFind: "Important",
    matchInstance: 1  // First occurrence
  },
  style: {
    bold: true,
    foregroundColor: "#FF0000"
  }
});

// Apply Heading 1 style to paragraph containing text
await applyParagraphStyle({
  documentId: "YOUR_DOC_ID",
  target: {
    textToFind: "Chapter 1",
    applyToContainingParagraph: true
  },
  style: {
    namedStyleType: "HEADING_1"
  }
});
```

### Working with Images

```javascript
// Insert image from URL
await insertImageFromUrl({
  documentId: "YOUR_DOC_ID",
  imageUrl: "https://example.com/image.jpg",
  index: 1,
  width: 400,
  height: 300
});

// Upload local image
await insertLocalImage({
  documentId: "YOUR_DOC_ID",
  localImagePath: "/path/to/image.png",
  index: 1,
  uploadToSameFolder: true
});
```

### Managing Comments

```javascript
// Add comment to text range
await addComment({
  documentId: "YOUR_DOC_ID",
  startIndex: 100,
  endIndex: 150,
  commentText: "Please review this section"
});

// Reply to comment
await replyToComment({
  documentId: "YOUR_DOC_ID",
  commentId: "COMMENT_ID",
  replyText: "Done!"
});
```

### Drive Operations

```javascript
// Search for documents
await searchGoogleDocs({
  searchQuery: "project report",
  searchIn: "both",
  modifiedAfter: "2024-01-01",
  maxResults: 10
});

// Create document from template
await createFromTemplate({
  templateId: "TEMPLATE_DOC_ID",
  newTitle: "Q1 Report",
  replacements: {
    "{{NAME}}": "John Doe",
    "{{DATE}}": "2024-01-15",
    "{{QUARTER}}": "Q1"
  }
});
```

---

## Security Features

This server includes comprehensive security hardening:

### Query Injection Prevention
- All Drive API queries are sanitized using `escapeDriveQuery()`
- Escapes single quotes and backslashes
- Prevents malicious query injection attacks

### SSRF Protection
- URL validation in `insertImageFromUrl`
- Only HTTP/HTTPS protocols allowed
- Blocks access to private IP ranges:
  - localhost (127.0.0.0/8)
  - Private networks (10.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12)
  - Link-local addresses (169.254.0.0/16)
- Prevents internal network scanning

### Path Traversal Prevention
- File path validation in `uploadImageToDrive`
- Blocks paths containing '..' or '~'
- Uses path.resolve() for normalization
- Verifies files are regular files (not directories/special files)
- Validates supported image formats only

### Error Handling
- Fail-fast security model
- No dangerous global exception handlers
- Proper error propagation and logging
- User-friendly error messages without exposing internals

---

## Claude Code Agents

This project includes 6 specialized AI agents for development assistance:

1. **google-docs-api-engineer** - Expert for Google Docs/Drive API work
2. **google-sheets-api-expert** - Specialist for Google Sheets integration
3. **google-chat-api-engineer** - Expert for Google Chat bot development
4. **architecture-documenter** - Creates C4 diagrams, sequence diagrams, and ADRs
5. **security-auditor** - Analyzes code for vulnerabilities and security issues
6. **senior-engineer** - Reviews code quality and suggests refactoring improvements

Agents are located in `.claude/agents/` and can be invoked through Claude Code.

---

## License

This project is licensed under the MIT License - see the `LICENSE` file for details. (Note: You should add a `LICENSE` file containing the MIT License text to your repository).

---
